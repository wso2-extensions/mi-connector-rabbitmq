<!--
~  Copyright (c) 2025, WSO2 LLC. (http://wso2.com) All Rights Reserved.
~
~  WSO2 LLC. licenses this file to you under the Apache License,
~  Version 2.0 (the "License"); you may not use this file except
~  in compliance with the License.
~  You may obtain a copy of the License at
~
~   http://www.apache.org/licenses/LICENSE-2.0
~
~  Unless required by applicable law or agreed to in writing,
~  software distributed under the License is distributed on an
~  "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
~  KIND, either express or implied.  See the License for the
~  specific language governing permissions and limitations
~  under the License.
-->

<template xmlns="http://ws.apache.org/ns/synapse" name="sendRpc">
    <parameter name="headers" description=""/>
    <parameter name="requestBodyType" description=""/>
    <parameter name="requestBodyJson" description=""/>
    <parameter name="requestBodyXml" description=""/>
    <parameter name="requestBodyText" description=""/>
    <parameter name="responseBodyType" description=""/>
    <parameter name="requestCharSet" description=""/>
    <parameter name="responseCharSet" description=""/>

    <parameter name="queue" description="The name of the Queue."/>
    <parameter name="queueAutoDeclare" description="If enabled, the connector will attempt to declare the specified queue on the RabbitMQ server if it doesn't already exist."/>
    <parameter name="queueType" description="Select the type of RabbitMQ queue to interact with: Classic, Quorum (for high availability), or Stream (for large, continuous message flows)."/>
    <parameter name="queueArguments" description="Additional arguments (comma-separated key=value pairs) to use when declaring the queue, e.g., for setting policy attributes like message-ttl or max-length."/>
    <parameter name="classicVersion" description="For Classic Queues, select the queue version (V1 or V2). V2 offers better performance and scale."/>
    <parameter name="maxPriority" description="For Classic Queues: the maximum priority level the queue should support (0-255). Requires setting 'x-max-priority' in queue arguments."/>
    <parameter name="initialMemberCount" description="For Quorum Queues: the initial number of replica nodes required for the queue."/>
    <parameter name="deliveryLimit" description="For Quorum Queues: the maximum number of times a message can be redelivered to a consumer before being dead-lettered."/>
    <parameter name="deadLetterStrategy" description="For Quorum Queues: defines the acknowledgment and redelivery behavior for failed messages."/>
    <parameter name="maxAge" description="For STREAM queues: the maximum retention time for stream data (e.g., '7d' for 7 days). Old messages will be discarded."/>
    <parameter name="maxSegmentSize" description="For STREAM queues: the maximum size (in bytes) of a single segment file within the stream storage."/>
    <parameter name="queueExclusive" description="If enabled, the queue will be deleted when the connection that declared it closes. Only one consumer can use an exclusive queue."/>
    <parameter name="queueAutoDelete" description="If enabled, the queue will be automatically deleted when the last consumer disconnects from it."/>
    <parameter name="queueOverflowStrategy" description="Defines what happens when a queue reaches its maximum length: **DROP_HEAD** (oldest messages are discarded), **REJECT_PUBLISH** (new messages are rejected), or **REJECT_PUBLISH_DLX** (rejected and sent to the Dead Letter Exchange)."/>
    <parameter name="replyToQueue" description="The name of the Reply-To Queue."/>
    <parameter name="replyToQueueAutoDeclare" description="If enabled, the connector will attempt to declare the specified queue on the RabbitMQ server if it doesn't already exist."/>
    <parameter name="replyToQueueType" description="Select the type of RabbitMQ queue to interact with: Classic, Quorum (for high availability), or Stream (for large, continuous message flows)."/>
    <parameter name="replyToQueueArguments" description="Additional arguments (comma-separated key=value pairs) to use when declaring the queue, e.g., for setting policy attributes like message-ttl or max-length."/>
    <parameter name="replyToQueueClassicVersion" description="For Classic Queues, select the queue version (V1 or V2). V2 offers better performance and scale."/>
    <parameter name="replyToQueueMaxPriority" description="For Classic Queues: the maximum priority level the queue should support (0-255). Requires setting 'x-max-priority' in queue arguments."/>
    <parameter name="replyToQueueInitialMemberCount" description="For Quorum Queues: the initial number of replica nodes required for the queue."/>
    <parameter name="replyToQueueDeliveryLimit" description="For Quorum Queues: the maximum number of times a message can be redelivered to a consumer before being dead-lettered."/>
    <parameter name="replyToQueueDeadLetterStrategy" description="For Quorum Queues: defines the acknowledgment and redelivery behavior for failed messages."/>
    <parameter name="replyToQueueMaxAge" description="For STREAM queues: the maximum retention time for stream data (e.g., '7d' for 7 days). Old messages will be discarded."/>
    <parameter name="replyToQueueMaxSegmentSize" description="For STREAM queues: the maximum size (in bytes) of a single segment file within the stream storage."/>
    <parameter name="replyToQueueExclusive" description="If enabled, the queue will be deleted when the connection that declared it closes. Only one consumer can use an exclusive queue."/>
    <parameter name="replyToQueueAutoDelete" description="If enabled, the queue will be automatically deleted when the last consumer disconnects from it."/>
    <parameter name="replyToQueueOverflowStrategy" description="Defines what happens when a queue reaches its maximum length: **DROP_HEAD** (oldest messages are discarded), **REJECT_PUBLISH** (new messages are rejected), or **REJECT_PUBLISH_DLX** (rejected and sent to the Dead Letter Exchange)."/>
    <parameter name="requestTimeout" description="The maximum time (in milliseconds) to wait for sending the RPC request."/>
    <parameter name="responseVariable" description="Name of the variable to which the output of the operation should be assigned"/>
    <parameter name="overwriteBody" description="Replace the Message Body in Message Context with the output of the operation (This will remove the payload from the above variable)."/>
    <sequence>
        <property name="RABBITMQ_CONN_HEADERS" expression="$func:headers"/>
        <property name="RABBITMQ_CONN_REQUEST_BODY_TYPE" expression="$func:requestBodyType"/>
        <property name="RABBITMQ_CONN_REQUEST_BODY_JSON" expression="$func:requestBodyJson"/>
        <property name="RABBITMQ_CONN_REQUEST_BODY_XML" expression="$func:requestBodyXml"/>
        <property name="RABBITMQ_CONN_REQUEST_BODY_TEXT" expression="$func:requestBodyText"/>
        <property name="RABBITMQ_CONN_REQUEST_CHARSET" expression="$func:requestCharSet"/>
        <property name="RABBITMQ_CONN_RESPONSE_BODY_TYPE" expression="$func:responseBodyType"/>
        <property name="RABBITMQ_CONN_RESPONSE_CHARSET" expression="$func:responseCharSet"/>
        <class name="org.wso2.integration.connector.operations.SendRpc"/>
    </sequence>
</template>
